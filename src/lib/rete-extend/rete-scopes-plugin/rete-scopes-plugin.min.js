/*!
* rete-scopes-plugin v2.0.1
* (c) 2024 Vitaliy Stoliarov
* Released under the CC-BY-NC-SA-4.0 license.
* */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("rete"),require("rete-area-plugin")):"function"==typeof define&&define.amd?define(["exports","rete","rete-area-plugin"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).ReteScopesPlugin={},e.Rete,e.ReteAreaPlugin)}(this,(function(e,t,r){"use strict";function n(e,t,r){return t=h(t),function(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,o()?Reflect.construct(t,r||[],h(e).constructor):t.apply(e,r))}function o(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(o=function(){return!!e})()}function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function a(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){d(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function u(){u=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",f=i.toStringTag||"@@toStringTag";function s(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{s({},"")}catch(e){s=function(e,t,r){return e[t]=r}}function l(e,t,r,n){var i=t&&t.prototype instanceof w?t:w,a=Object.create(i.prototype),u=new T(n||[]);return o(a,"_invoke",{value:N(e,r,u)}),a}function p(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=l;var d="suspendedStart",h="suspendedYield",y="executing",v="completed",g={};function w(){}function b(){}function m(){}var x={};s(x,a,(function(){return this}));var O=Object.getPrototypeOf,k=O&&O(O(A([])));k&&k!==r&&n.call(k,a)&&(x=k);var E=m.prototype=w.prototype=Object.create(x);function j(e){["next","throw","return"].forEach((function(t){s(e,t,(function(e){return this._invoke(t,e)}))}))}function P(e,t){function r(o,i,a,u){var c=p(e[o],e,i);if("throw"!==c.type){var f=c.arg,s=f.value;return s&&"object"==typeof s&&n.call(s,"__await")?t.resolve(s.__await).then((function(e){r("next",e,a,u)}),(function(e){r("throw",e,a,u)})):t.resolve(s).then((function(e){f.value=e,a(f)}),(function(e){return r("throw",e,a,u)}))}u(c.arg)}var i;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return i=i?i.then(o,o):o()}})}function N(t,r,n){var o=d;return function(i,a){if(o===y)throw Error("Generator is already running");if(o===v){if("throw"===i)throw a;return{value:e,done:!0}}for(n.method=i,n.arg=a;;){var u=n.delegate;if(u){var c=_(u,n);if(c){if(c===g)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===d)throw o=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=y;var f=p(t,r,n);if("normal"===f.type){if(o=n.done?v:h,f.arg===g)continue;return{value:f.arg,done:n.done}}"throw"===f.type&&(o=v,n.method="throw",n.arg=f.arg)}}}function _(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,_(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var i=p(o,t.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,g;var a=i.arg;return a?a.done?(r[t.resultName]=a.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,g):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function L(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function A(t){if(t||""===t){var r=t[a];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return i.next=i}}throw new TypeError(typeof t+" is not iterable")}return b.prototype=m,o(E,"constructor",{value:m,configurable:!0}),o(m,"constructor",{value:b,configurable:!0}),b.displayName=s(m,f,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,m):(e.__proto__=m,s(e,f,"GeneratorFunction")),e.prototype=Object.create(E),e},t.awrap=function(e){return{__await:e}},j(P.prototype),s(P.prototype,c,(function(){return this})),t.AsyncIterator=P,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new P(l(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},j(E),s(E,f,"Generator"),s(E,a,(function(){return this})),s(E,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=A,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(L),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return u.type="throw",u.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],u=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),f=n.call(a,"finallyLoc");if(c&&f){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!f)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,g):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),L(r),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;L(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:A(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),g}},t}function c(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}function f(e){return f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},f(e)}function s(e,t,r,n,o,i,a){try{var u=e[i](a),c=u.value}catch(e){return void r(e)}u.done?t(c):Promise.resolve(c).then(n,o)}function l(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){s(i,n,o,a,u,"next",e)}function u(e){s(i,n,o,a,u,"throw",e)}a(void 0)}))}}function p(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,c(n.key),n)}}function d(e,t,r){return(t=c(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function h(e){return h=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},h(e)}function y(e,t){return y=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},y(e,t)}function v(){return v="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=h(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(arguments.length<3?e:r):o.value}},v.apply(this,arguments)}function g(e){return function(e){if(Array.isArray(e))return b(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||w(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function w(e,t){if(e){if("string"==typeof e)return b(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?b(e,t):void 0}}function b(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function m(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=w(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,u=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){u=!0,i=e},f:function(){try{a||null==r.return||r.return()}finally{if(u)throw i}}}}function x(e,t){var r=t.area.connectionViews.get(e),n=t.area.area.content;r&&n.reorder(r.element,n.holder.firstChild)}function O(e,t){var r=t.area.nodeViews.get(e),n=t.editor.getConnections().filter((function(t){return e===t.source||e===t.target})),o=t.editor.getNodes().filter((function(t){return t.parent===e}));n.forEach((function(e){return function(e,t){var r=t.area.connectionViews.get(e);r&&t.area.area.content.reorder(r.element,null)}(e.id,t)})),r&&t.area.area.content.reorder(r.element,null),o.forEach((function(e){return O(e.id,t)}))}function k(e,t){var r=t.area,n=e.map((function(e){var t=r.nodeViews.get(e.id);if(!t)throw new Error("view");return{position:t.position,width:e.width,height:e.height}})),o=Math.min.apply(Math,g(n.map((function(e){return e.position.x})))),i=Math.max.apply(Math,g(n.map((function(e){return e.position.x+e.width})))),a=Math.min.apply(Math,g(n.map((function(e){return e.position.y})))),u=Math.max.apply(Math,g(n.map((function(e){return e.position.y+e.height}))));return{top:a,left:o,right:i,bottom:u,width:i-o,height:u-a}}function E(e,t,r){var n=r.area,o=t.width,i=t.height;e.width=o,e.height=i,n.resize(e.id,o,i)}function j(e,t,r){return P.apply(this,arguments)}function P(){return(P=l(u().mark((function e(t,r,n){var o,i,a,c,f,s,l,p,d,h,y,v,g,w;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=t.id,i=n.editor.getNodes().filter((function(e){return e.parent===o})).filter((function(e){return!r.exclude(e.id)})),a=r.padding(o),0!==i.length){e.next=8;break}c=r.size(o,{width:a.left+a.right,height:a.top+a.bottom}),E(t,c,n),e.next=16;break;case 8:return f=k(i,n),s=f.top,l=f.left,p=f.width,d=f.height,h=p+a.left+a.right,y=d+a.top+a.bottom,v=s-a.top,g=l-a.left,E(t,r.size(o,{width:h,height:y}),n),e.next=16,r.translate(t.id,g,v);case 16:if(!t.parent){e.next=21;break}if(!(w=n.editor.getNode(t.parent))){e.next=21;break}return e.next=21,j(w,r,n);case 21:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function N(e,t,r,n){return _.apply(this,arguments)}function _(){return(_=l(u().mark((function e(t,r,n,o){var i,a,c,f,s,l,p,d,h;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.length){e.next=2;break}return e.abrupt("return");case 2:if(i=t.map((function(e){return o.editor.getNode(e)})).filter((function(e){return Boolean(e)})),a=o.editor.getNodes().filter((function(e){return n.elder(e.id)})).map((function(e){var t=o.area.nodeViews.get(e.id);if(!t)throw new Error("node view");return{node:e,view:t}})).filter((function(e){var n=e.node,o=e.view;return!t.includes(n.id)&&r.x>o.position.x&&r.y>o.position.y&&r.x<o.position.x+n.width&&r.y<o.position.y+n.height})),c=Array.from(o.area.area.content.holder.childNodes),(f=a.map((function(e){var t=e.node,r=e.view;return{node:t,view:r,index:c.indexOf(r.element)}}))).sort((function(e,t){return t.index-e.index})),s=f[0],l=i.map((function(e){return e.parent})).filter((function(e){return Boolean(e)})).map((function(e){var t=o.editor.getNode(e);if(!t)throw new Error("node");return t})),i.forEach((function(e){return e.parent=void 0})),!s){e.next=14;break}return i.forEach((function(e){return e.parent=s.node.id})),e.next=14,j(s.node,n,o);case 14:p=m(l),e.prev=15,p.s();case 17:if((d=p.n()).done){e.next=23;break}return h=d.value,e.next=21,j(h,n,o);case 21:e.next=17;break;case 23:e.next=28;break;case 25:e.prev=25,e.t0=e.catch(15),p.e(e.t0);case 28:return e.prev=28,p.f(),e.finish(28);case 31:case"end":return e.stop()}}),e,null,[[15,25,28,31]])})))).apply(this,arguments)}function S(e,t,r){return L.apply(this,arguments)}function L(){return L=l(u().mark((function e(t,r,n){var o,i,a;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=r.position,i=r.previous,a=n.editor.getNodes().filter((function(e){return e.parent===t})),e.next=4,Promise.all(a.map(function(){var e=l(u().mark((function e(t){var r,a,c,f,s;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=o.x-i.x,a=o.y-i.y,c=n.area.nodeViews.get(t.id),f=n.editor.getNode(t.id),!c||!f||f.selected){e.next=8;break}return s=c.position,e.next=8,c.translate(s.x+r,s.y+a);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 4:case"end":return e.stop()}}),e)}))),L.apply(this,arguments)}function T(e,t,r){var n=r.editor.getNode(e);if(!n)throw new Error("node");return!!t.includes(e)||!!n.parent&&(!!T(n.parent,t,r)||void 0)}function A(e,t){var r=t.editor.getNode(e);if(!r)throw new Error("node");if(!r.parent)return!1;var n=t.editor.getNode(r.parent);if(!n)throw new Error("node");return!!n.selected||A(r.parent,t)}var M=Object.freeze({__proto__:null,setup:function(){return function(e,t){!function(e,t){var r=t.area,n=t.editor,o=t.scopes,i=e.timeout||250,a=null,c=[];function f(){a&&(window.clearTimeout(a.timeout),a=null)}function s(e){var t=window.setTimeout((function(){var t,r=n.getNodes().filter((function(e){return e.selected})),i=r.length?r.map((function(e){return e.id})):[e];(t=c).push.apply(t,g(i)),o.emit({type:"scopepicked",data:{ids:i}})}),i);a={timeout:t}}r.addPipe(function(){var t=l(u().mark((function t(i){var a,l;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i instanceof Object&&"type"in i){t.next=2;break}return t.abrupt("return",i);case 2:if("nodepicked"===i.type&&s(i.data.id),"nodetranslated"===i.type&&f(),"nodedragged"!==i.type){t.next=11;break}if(a=r.area.pointer,u=void 0,u=g(c),f(),c=[],o.emit({type:"scopereleased",data:{ids:u}}),0!==(l=u).length){t.next=9;break}return t.abrupt("return");case 9:return t.next=11,N(l,a,e,{area:r,editor:n});case 11:return t.abrupt("return",i);case 12:case"end":return t.stop()}var u}),t)})));return function(e){return t.apply(this,arguments)}}())}(e,t),function(e,t){var r=t.area,n=t.editor,o=t.scopes,i=R(o),a=null,u=null;function c(t,o){if(a){var i=r.nodeViews.get(a);i&&o.length&&(i.element.style.opacity="0.4"),a=null}if(o.length){var u=t.x,c=t.y,f=document.elementsFromPoint(u,c),s=n.getNodes().filter((function(t){return e.elder(t.id)})).map((function(e){var t=r.nodeViews.get(e.id);if(!t)throw new Error("view");return{node:e,view:t}})),l=f.map((function(e){return s.find((function(t){return t.view.element===e}))})).filter((function(e){return Boolean(e)})).filter((function(e){return!e.node.selected}))[0];l&&(l.view.element.style.opacity="0.8",a=l.node.id)}}o.addPipe((function(e){if("scopepicked"===e.type){var t=e.data.ids;n.getNodes().filter((function(e){return!t.includes(e.id)})).forEach((function(e){var t=r.nodeViews.get(e.id);t&&(t.element.style.opacity="0.4")})),u&&c(u,i)}if("scopereleased"===e.type){var o=e.data.ids;n.getNodes().filter((function(e){return!o.includes(e.id)})).forEach((function(e){var t=r.nodeViews.get(e.id);t&&(t.element.style.opacity="")})),u&&c(u,i)}return"pointermove"===e.type&&c(u={x:e.data.event.clientX,y:e.data.event.clientY},i),e}))}(e,t)}}}),V=Object.freeze({__proto__:null,classic:M}),z=function(e){function o(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),d(t=n(this,o,["scopes"]),"presets",[]),t.padding=(null==e?void 0:e.padding)||function(){return{top:40,left:20,right:20,bottom:20}},t.exclude=(null==e?void 0:e.exclude)||function(){return!1},t.size=(null==e?void 0:e.size)||function(e,t){return t},t.elder=(null==e?void 0:e.elder)||function(){return!0},t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&y(e,t)}(o,e),i=o,c=[{key:"setParent",value:function(e){var n=this;v(h(o.prototype),"setParent",this).call(this,e),this.area=this.parentScope(r.BaseAreaPlugin),this.editor=this.area.parentScope(t.NodeEditor);var i={editor:this.editor,area:this.area},c=this.padding,s=this.size,p=this.exclude,d=this.elder,y=R(this),g=function(e){var t=new Map,r=function(e){return t.set(e,(t.get(e)||0)+1)},n=function(e){return t.set(e,(t.get(e)||0)-1)};return{translate:function(t,o,i){return l(u().mark((function a(){var c,f;return u().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(c=e.area.nodeViews.get(t)){a.next=3;break}throw new Error("cannot find parent node view");case 3:if((f=c.position).x===o&&f.y===i){a.next=9;break}return r(t),a.next=8,c.translate(o,i);case 8:n(t);case 9:case"end":return a.stop()}}),a)})))()},isTranslating:function(e){return(t.get(e)||0)>0}}}(i),w=g.translate,b=g.isTranslating,m={padding:c,size:s,exclude:p,elder:d,translate:w};!function(e){var t,r,n=(t=e.editor,r=!1,t.addPipe((function(e){return"clear"===e.type&&(r=!0),"cleared"!==e.type&&"clearcancelled"!==e.type||(r=!1),e})),function(){return r});e.area.addPipe((function(t){if(!t||"object"!==f(t)||!("type"in t))return t;if("nodecreate"===t.type){var r=t.data.parent;if(r&&!e.editor.getNodes().find((function(e){return e.id===r})))throw new Error("parent node doesnt exist")}if("noderemove"===t.type&&!n()){var o=t.data.id;if(e.editor.getNodes().find((function(e){return e.parent===o})))throw new Error("cannot remove parent node with a children")}return t}))}(i),function(e){e.area.addPipe(function(){var t=l(u().mark((function t(r){var n,o;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r instanceof Object&&"type"in r){t.next=2;break}return t.abrupt("return",r);case 2:if("nodepicked"===r.type&&O(r.data.id,e),"connectioncreated"!==r.type){t.next=11;break}if(n=r.data.id,o=e.editor.getConnection(n)){t.next=8;break}throw new Error("connection was removed");case 8:x(r.data.id,e),O(o.source,e),O(o.target,e);case 11:return t.abrupt("return",r);case 12:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}(i),this.presets.forEach((function(e){e(m,a(a({},i),{},{scopes:n}))})),this.addPipe(function(){var e=l(u().mark((function e(t){var r,n,o,a,c,f,s;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("nodetranslated"!==t.type){e.next=15;break}if(r=t.data.id,n=i.editor.getNode(r)){e.next=5;break}throw new Error("cannot find node");case 5:if(b(r)){e.next=8;break}return e.next=8,S(r,t.data,i);case 8:if(!(o=n.parent?i.editor.getNode(n.parent):null)||m.exclude(r)){e.next=15;break}if(a=A(r,i),c=T(n.id,y,i),a||c){e.next=15;break}return e.next=15,j(o,m,i);case 15:if("noderemoved"!==t.type){e.next=21;break}if(f=t.data.parent,!(s=f&&i.editor.getNode(f))){e.next=21;break}return e.next=21,j(s,m,i);case 21:return e.abrupt("return",t);case 22:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}},{key:"addPreset",value:function(e){this.presets.push(e)}},{key:"isDependent",value:function(e){var t={editor:this.editor,area:this.area},r=this.editor.getNode(e);return r&&(r.selected||A(e,t))}}],c&&p(i.prototype,c),s&&p(i,s),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,c,s}(t.Scope);function R(e){var t=[];return e.addPipe(function(){var e=l(u().mark((function e(r){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("type"in r){e.next=2;break}return e.abrupt("return",r);case 2:return"scopepicked"===r.type&&t.push.apply(t,g(r.data.ids)),"scopereleased"===r.type&&t.splice.apply(t,[0,t.length].concat(g(t.filter((function(e){return!r.data.ids.includes(e)}))))),e.abrupt("return",r);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),t}e.Presets=V,e.ScopesPlugin=z,e.getPickedNodes=R,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=rete-scopes-plugin.min.js.map
